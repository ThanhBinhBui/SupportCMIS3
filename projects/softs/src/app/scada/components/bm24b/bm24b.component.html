<p-confirmDialog header="Xác nhận" icon="pi pi-exclamation-triangle" acceptButtonStyleClass="ui-button-info"
    acceptLabel="Đồng ý" rejectLabel="Hủy bỏ">
</p-confirmDialog>
<p-toast></p-toast>
<div class="card" *ngIf="dialog">
    <p-fieldset [legend]="isUpdate?'Cập Nhật Thông Tin':'Thêm Mới Thông Tin'" class="p-field p-col-12 p-md-4"
        [toggleable]="true">
        <div class="p-fluid p-grid p-formgrid">
            <div class="p-field p-col-12 p-md-4" >
                <label for="name">Thời gian bắt đầu (*):</label>
                <p-calendar [(ngModel)]="mainCurrent.START_TIME" [showTime]="true" dateFormat="dd/mm/yy">
                </p-calendar>
            </div>
            <div class="p-field p-col-12 p-md-4" >
                <label for="name">Thời gian kết thúc (*):</label>
                <p-calendar [(ngModel)]="mainCurrent.END_TIME" [showTime]="true" dateFormat="dd/mm/yy">
                </p-calendar>
            </div>
            <div class="p-field p-col-12 p-md-4" >
                <label for="name">Đơn vị quản lý (*):</label>
                <p-dropdown [options]="tinhs" [(ngModel)]="selectedDonViQuanLy" optionLabel="TEN_DVIQLY"
                    optionValue="MA_DVIQLY" filter="true">
                </p-dropdown>
            </div>
            <div class="p-field p-col-12 p-md-6" >
                <label for="name">TBA/NMĐ/TTĐK/REC/LBS: B3 (ASDU)/Tuyến SDH/IP (*):</label>
                <!-- <input type="text" pInputText [(ngModel)]="mainCurrent.SU_KIEN" /> -->
                <textarea [rows]="5" pInputTextarea [(ngModel)]="mainCurrent.TEN_TB"></textarea>
            </div>
            <div class="p-field p-col-12 p-md-6" >
                <label for="name">Sự kiện/ dịch vụ ảnh hưởng (*):</label>
                <!-- <input type="text" pInputText [(ngModel)]="mainCurrent.SU_KIEN" /> -->
                <textarea [rows]="5" pInputTextarea [(ngModel)]="mainCurrent.SU_KIEN"></textarea>
            </div>
            <div class="p-field p-col-12 p-md-6" >
                <label for="name">Quá trình xử lý (*):</label>
                <!-- <input type="text" pInputText [(ngModel)]="mainCurrent.SU_KIEN" /> -->
                <textarea [rows]="5" pInputTextarea [(ngModel)]="mainCurrent.QUA_TRINH"></textarea>
            </div>
            <div class="p-field p-col-12 p-md-6" >
                <label for="name">Nguyên nhân (*):</label>
                <!-- <input type="text" pInputText [(ngModel)]="mainCurrent.NGUYEN_NHAN" /> -->
                <textarea [rows]="5" pInputTextarea [(ngModel)]="mainCurrent.NGUYEN_NHAN"></textarea>
            </div>
            <div class="p-field p-col-12 p-md-12" >
                <label for="name">Phân loại sự kiện (*):</label>
                <div class="p-field-radiobutton">
                    <div class="p-md-2">
                        <p-radioButton value="Lỗi kênh truyền VTDR" [(ngModel)]="mainCurrent.LOAI_SUKIEN"></p-radioButton>
                        <label> Lỗi kênh truyền VTDR</label>
                    </div>
                    <div class="p-md-2">
                        <p-radioButton value="Không có tín hiệu TRIP" [(ngModel)]="mainCurrent.LOAI_SUKIEN"></p-radioButton>
                        <label> Không có tín hiệu TRIP</label>
                    </div>
                    <div class="p-md-2">
                        <p-radioButton value="Sự cố VTDR, CNTT, TĐH" [(ngModel)]="mainCurrent.LOAI_SUKIEN">
                        </p-radioButton>
                        <label> Sự cố VTDR, CNTT, TĐH</label>
                    </div>
                    <div class="p-md-2">
                        <p-radioButton value="Công tác SCADA" [(ngModel)]="mainCurrent.LOAI_SUKIEN"></p-radioButton>
                        <label> Công tác SCADA</label>
                    </div>
                    <div class="p-md-2">
                        <p-radioButton value="Khác" [(ngModel)]="mainCurrent.LOAI_SUKIEN"></p-radioButton>
                        <label> Khác</label>
                    </div>
                </div>
            </div>            
            <div class="p-field p-col-12 p-md-4" >
                <label for="name">Tiếp nhận thông tin đơn vị khác (*):</label>
                <input type="text" pInputText [(ngModel)]="mainCurrent.TIEPNHAN_NGOAI" />
            </div>
            <div class="p-field p-col-12 p-md-4" >
                <label for="name">Tiếp nhận thông tin TT SCADA (*):</label>
                <input type="text" pInputText [(ngModel)]="mainCurrent.TIEPNHAN_SCADA" />
            </div>            
            <div class="p-field p-col-12 p-md-4" >
                <label for="name">Đơn vị xử lý (*):</label>
                <p-dropdown [options]="tinhs" [(ngModel)]="selectedDonViQuanLyNgoai" optionLabel="TEN_DVIQLY"
                    optionValue="MA_DVIQLY" filter="true">
                </p-dropdown>
            </div>      
            <div class="p-field p-col-12 p-md-6" >
                <label for="name">Thời gian xử lý:</label>
                <!-- <input type="text" pInputText [(ngModel)]="mainCurrent.GHI_CHU" /> -->
                <textarea [rows]="5" pInputTextarea [(ngModel)]="mainCurrent.THOI_GIAN"></textarea>
            </div>
            <div class="p-field p-col-12 p-md-6" >
                <label for="name">Ghi chú:</label>
                <!-- <input type="text" pInputText [(ngModel)]="mainCurrent.GHI_CHU" /> -->
                <textarea [rows]="5" pInputTextarea [(ngModel)]="mainCurrent.GHI_CHU"></textarea>
            </div>
        </div>

    </p-fieldset>
    <div class="p-field p-col-12 p-md-12">
        <button pButton pRipple label="Hủy" icon="pi pi-times" class="p-button-secondary"
            (click)="hideDialog()"></button>
        <button pButton pRipple label="Lưu" icon="pi pi-check" class="p-button-info" (click)="saveItem()"
            style="margin-left: 20px;"></button>
    </div>
</div>
<div class="card" *ngIf="!dialog">
    <div class="p-grid">
        <div class="p-md-4 p-sm-4 p-d-flex p-jc-start">
            <span class="p-input-icon-left">
                <!-- <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
                            placeholder="Lọc..." /> -->
                <button pButton pRipple label="Thêm" icon="pi pi-plus" class="p-button-success p-mr-2 p-mb-2"
                    (click)="openNewCa()"></button>
            </span>
        </div>
        <!-- <div class="p-md-4 p-sm-4 p-d-flex p-jc-end">
                    <p-dropdown inputId="ORG_CODE" [options]="lstORG" [(ngModel)]="selectedORG_CODE"
                        optionLabel="ORG_NAME" optionValue="ORG_CODE" filter="true" (onChange)="search()">
                    </p-dropdown>
                </div> -->

        <div class="p-md-8 p-sm-8 p-d-flex p-jc-end">
            <div class="p-mb-2 p-mr-2">
                <p-calendar dateFormat="dd/mm/yy" dataType="string" [showIcon]="true" placeholder="Từ Ngày"
                    [selectOtherMonths]="true" [(ngModel)]="FROM_DATE" firstDayOfWeek=1
                    (onSelect)="onChangeDate(FROM_DATE)" inputStyleClass="calendarInput">
                </p-calendar>
            </div>
            <div class="p-mb-2 p-mr-2">
                <p-calendar dateFormat="dd/mm/yy" dataType="string" [showIcon]="true" placeholder="Đến Ngày"
                    [selectOtherMonths]="true" [(ngModel)]="TO_DATE" firstDayOfWeek=1
                    (onSelect)="onChangeDate(TO_DATE)" inputStyleClass="calendarInput">
                </p-calendar>
            </div>
            <div class="p-mb-2 p-mr-2">
                <button pButton pRipple (click)="search()" icon="pi pi-search"
                    class="p-button-success p-mt-1"></button>
            </div>
            <!-- <div class="p-mb-2 p-mr-2">
                <button pButton pRipple label="Export Excel" icon="pi pi-upload" class="p-button-help p-mt-1"
                    (click)="exportExcel()"></button>
                <button pButton pRipple label="Export PDF" icon="pi pi-upload" class="p-button-help p-mt-1"
                    (click)="exportPDF()"></button>
            </div> -->
        </div>
    </div>
    <p-table id="Test1" #dt [value]="listMain" dataKey="STT" [rowHover]="true" [rows]="50" [paginator]="true"
        [filterDelay]="0" [loading]="loadingSuKien" [globalFilterFields]="['TEN_TRAM','STT','TEN_DVIQLY']"
        currentPageReportTemplate="Hiển thị từ {first} đến {last} trên {totalRecords}" [responsive]="true"
        [showCurrentPageReport]="true" [scrollable]="true" [style]="{'width':'100%'}" scrollHeight="100%">
        <ng-template pTemplate="headergrouped">
            <tr class="trHeader">
                <th colspan="2" style="width: 300px;">Ngày Giờ</th>
                <th rowspan="2" style="width: 300px;">TBA/NMĐ/TTĐK/REC/LBS: B3 (ASDU)/Tuyến SDH/IP</th>
                <th rowspan="2" style="width: 150px;">ĐƠN VỊ QUẢN LÝ</th>
                <th rowspan="2" style="width: 300px;">SỰ KIỆN/ DỊCH VỤ ẢNH HƯỞNG</th>
                <th rowspan="2" style="width: 300px;">QUÁ TRÌNH XỬ LÝ</th>
                <th rowspan="2" style="width: 300px;">NGUYÊN NHÂN</th>
                <th rowspan="2" style="width: 150px;">PHÂN LOẠI SỰ KIỆN</th>
                <th colspan="2" style="width: 300px;">TIÊP NHẬN THÔNG TIN</th>
                <th rowspan="2" style="width: 150px;">ĐƠN VỊ XỬ LÝ</th>
                <th rowspan="2" style="width: 300px;">THỜI GIAN XỬ LÝ</th>
                <th rowspan="2" style="width: 300px;">GHI CHÚ/ĐÁNH GIÁ</th>
                <th rowspan="2" style="width: 150px;"></th>
            </tr>
            <tr class="trHeader">
                <th style="width: 150px;">Bắt đầu</th>
                <th style="width: 150px;">Kết thúc</th>
                <th style="width: 150px;">Đơn vị khác</th>
                <th style="width: 150px;">TTĐH SCADA</th>
            </tr>
            <tr>
                <th colspan="14">1. Sự kiện trong ca trực:</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-main>
            <tr style="flex: 1;display: flex;">
                <!-- <td class="bodySTT" style="flex: 1;align-items: center;justify-content: center;">{{main.ID}}</td> -->

                <td style="flex:0.905;align-items: center;justify-content: flex-start;">
                    {{main.START_TIME | date: 'dd/MM/yyyy hh:mm:ss a'}}</td>
                <td style="flex:0.905;align-items: center;justify-content: flex-start;">
                    {{main.END_TIME==='0001-01-01T00:00:00'?null:main.END_TIME | date: 'dd/MM/yyyy hh:mm:ss a'}}</td>
                <td style="flex: 2.03942896;align-items: center;justify-content: flex-start;">
                    {{main.TEN_TB}}</td>
                <td style="flex:0.905;align-items: center;justify-content: flex-start;">
                    {{getNameDonViQuanLy(main.DONVI_QUANLY)}}</td>
                <td style="flex: 2.03942896;align-items: center;justify-content: flex-start;">
                    {{main.SU_KIEN}}</td>
                <td style="flex: 2.03942896;align-items: center;justify-content: flex-start;">
                    {{main.QUA_TRINH}}</td>
                <td style="flex: 2.03942896;align-items: center;justify-content: flex-start;">
                    {{main.NGUYEN_NHAN}}</td>
                <td style="flex:0.905;align-items: center;justify-content: center;">
                    {{main.LOAI_SUKIEN}}</td>
                <td style="flex:0.905;align-items: center;justify-content: flex-start;">
                    {{main.TIEPNHAN_NGOAI}}</td>
                <td style="flex:0.905;align-items: center;justify-content: flex-start;">
                    {{main.TIEPNHAN_SCADA}}</td>
                <td style="flex:0.905;align-items: center;justify-content: flex-start;">
                    {{getNameDonViQuanLy(main.DONVI_XULY)}}</td>
                <td style="flex: 2.03942896;align-items: center;justify-content: flex-start;">
                    {{main.THOI_GIAN}}</td>
                <td style="flex: 2.03942896;align-items: center;justify-content: flex-start;">
                    {{main.GHI_CHU}}</td>
                <td style="flex:0.905;align-items: center;justify-content: center;">
                    <button *ngIf="checkVisibleThem()" pButton pRipple icon="pi pi-pencil"
                        class="p-button-rounded p-button-success p-mr-2" (click)="editItem(main)"></button>
                    <!-- <button *ngIf="checkVisibleThem()" pButton pRipple icon="pi pi-trash"
                        class="p-button-rounded p-button-warning" (click)="deleteItem(main)"></button> -->
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="18" style="align-items: center;justify-content: center;">Không có dữ liệu</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog header="Đang xử lý..." [(visible)]="loadingModal" [closeOnEscape]="false" closable="false" modal="true"
    closeIcon="null">
    <div class="p-md-12" style="justify-content: center;align-items: center;">
        <p-progressSpinner [style]="{width: '80px', height: '80px'}" styleClass="custom-spinner" strokeWidth="8"
            animationDuration=".5s"></p-progressSpinner>
    </div>

    <!-- <p-progressBar mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar> -->
</p-dialog>